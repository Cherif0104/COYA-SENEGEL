<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="coya_modern_navbar.CoyaHomeDashboard">
        <div class="coya-home-dashboard">
            <div class="coya-dashboard-container">
                <div class="coya-dashboard-header">
                    <h1 class="coya-dashboard-title">Tableau de bord COYA</h1>
                    <p class="coya-dashboard-subtitle">Vue 360° — Alertes, tâches et indicateurs</p>
                </div>

                <div class="coya-loading" t-if="state.loading">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                </div>

                <t t-if="!state.loading">
                    <!-- KPIs globaux -->
                    <div class="coya-kpis-row" t-if="state.kpis.length > 0">
                        <t t-foreach="state.kpis" t-as="kpi" t-key="kpi.id">
                            <div class="coya-kpi-card" t-on-click="() => this.openKpiList(kpi)" t-att-title="'Voir ' + kpi.label">
                                <div class="coya-kpi-icon"><i t-att-class="kpi.icon" aria-hidden="true"/></div>
                                <div class="coya-kpi-value" t-esc="kpi.value"/>
                                <div class="coya-kpi-label" t-esc="kpi.label"/>
                            </div>
                        </t>
                    </div>

                    <!-- Grille principale — vue 360° (tous les blocs affichés même vides) -->
                    <div class="coya-dashboard-grid">
                        <!-- Alertes -->
                        <div class="coya-dash-block coya-dash-alerts">
                            <h3 class="coya-dash-block-title"><i class="fa fa-exclamation-triangle"/> Alertes</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.insights.length > 0">
                                    <t t-foreach="state.insights" t-as="insight" t-key="insight.id">
                                        <div class="coya-dash-item" t-att-data-type="insight.type" t-on-click="() => this.openInsight(insight)">
                                            <span class="coya-dash-item-title" t-esc="insight.title"/>
                                            <span class="coya-dash-item-desc" t-esc="insight.message"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucune alerte</div>
                            </div>
                        </div>

                        <!-- Mes indicateurs -->
                        <div class="coya-dash-block coya-dash-indicators">
                            <h3 class="coya-dash-block-title"><i class="fa fa-line-chart"/> Mes indicateurs</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.userIndicators.length > 0">
                                    <t t-foreach="state.userIndicators" t-as="ind" t-key="ind.id">
                                        <div class="coya-dash-item coya-dash-item-click" t-on-click="() => this.openUserIndicator(ind)">
                                            <span class="coya-dash-item-value" t-esc="ind.value"/>
                                            <span class="coya-dash-item-title" t-esc="ind.label"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucun indicateur</div>
                            </div>
                        </div>

                        <!-- Planning — Mes tâches -->
                        <div class="coya-dash-block coya-dash-tasks">
                            <h3 class="coya-dash-block-title"><i class="fa fa-tasks"/> Planning — Mes tâches</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.tasks.length > 0">
                                    <t t-foreach="state.tasks" t-as="task" t-key="task.id">
                                        <div class="coya-dash-item coya-dash-item-click" t-on-click="() => this.openTask(task)">
                                            <span class="coya-dash-item-title" t-esc="task.name"/>
                                            <span class="coya-dash-item-meta" t-if="task.project_id" t-esc="task.project_id[1]"/>
                                            <span class="coya-dash-item-date" t-if="task.date_deadline" t-esc="this.formatDate(task.date_deadline)"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucune tâche assignée</div>
                            </div>
                        </div>

                        <!-- Actions à faire -->
                        <div class="coya-dash-block coya-dash-actions">
                            <h3 class="coya-dash-block-title"><i class="fa fa-wrench"/> Actions à faire</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.actionsDue.length > 0">
                                    <t t-foreach="state.actionsDue" t-as="item" t-key="item.id">
                                        <div class="coya-dash-item coya-dash-item-click" t-on-click="() => this.openActionDue(item)">
                                            <span class="coya-dash-item-badge" t-esc="item.type"/>
                                            <span class="coya-dash-item-title" t-esc="item.name"/>
                                            <span class="coya-dash-item-meta" t-if="item.extra" t-esc="item.extra"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Rien en attente</div>
                            </div>
                        </div>

                        <!-- Suggestions -->
                        <div class="coya-dash-block coya-dash-suggestions">
                            <h3 class="coya-dash-block-title"><i class="fa fa-lightbulb-o"/> Suggestions</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.suggestions.length > 0">
                                    <t t-foreach="state.suggestions" t-as="s" t-key="s.id">
                                        <div class="coya-dash-item coya-dash-item-click" t-on-click="() => this.openSuggestion(s)">
                                            <span class="coya-dash-item-title" t-esc="s.name"/>
                                            <span class="coya-dash-item-meta" t-if="s.partner" t-esc="s.partner"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucune suggestion</div>
                            </div>
                        </div>

                        <!-- Congés à valider -->
                        <div class="coya-dash-block coya-dash-leaves">
                            <h3 class="coya-dash-block-title"><i class="fa fa-calendar-check-o"/> Congés à valider</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.leaves.length > 0">
                                    <t t-foreach="state.leaves" t-as="l" t-key="l.id">
                                        <div class="coya-dash-item coya-dash-item-click" t-on-click="() => this.openLeave(l)">
                                            <span class="coya-dash-item-title" t-esc="l.name"/>
                                            <span class="coya-dash-item-meta" t-if="l.employee" t-esc="l.employee"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucun congé en attente</div>
                            </div>
                        </div>

                        <!-- Réunions du jour -->
                        <div class="coya-dash-block coya-dash-meetings">
                            <h3 class="coya-dash-block-title"><i class="fa fa-video-camera"/> Réunions du jour</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.meetings.length > 0">
                                    <t t-foreach="state.meetings" t-as="m" t-key="m.id">
                                        <div class="coya-dash-item coya-dash-item-click" t-on-click="() => this.openMeeting(m)">
                                            <span class="coya-dash-item-title" t-esc="m.name"/>
                                            <span class="coya-dash-item-date" t-if="m.start" t-esc="m.start"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucune réunion aujourd'hui</div>
                            </div>
                        </div>

                        <!-- Activité récente -->
                        <div class="coya-dash-block coya-dash-activity">
                            <h3 class="coya-dash-block-title"><i class="fa fa-bolt"/> Activité récente</h3>
                            <div class="coya-dash-list">
                                <t t-if="state.activity.length > 0">
                                    <t t-foreach="state.activity" t-as="item" t-key="item.id">
                                        <div class="coya-dash-item">
                                            <span class="coya-dash-item-type" t-esc="item.type"/>
                                            <span class="coya-dash-item-title" t-esc="item.name"/>
                                            <span class="coya-dash-item-date" t-esc="this.formatDate(item.date)"/>
                                        </div>
                                    </t>
                                </t>
                                <div class="coya-dash-empty" t-else="">Aucune activité récente</div>
                            </div>
                        </div>
                    </div>
                </t>
            </div>
        </div>
    </t>
</templates>
