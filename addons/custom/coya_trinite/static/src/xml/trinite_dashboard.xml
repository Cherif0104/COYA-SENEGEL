<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="coya_trinite.CoyaTriniteDashboard">
        <div class="coya-trinite-dashboard">
            <div class="coya-trinite-container">
                <div class="coya-trinite-header">
                    <h1 class="coya-trinite-title">Dashboard Trinité</h1>
                    <p class="coya-trinite-subtitle">Productivité · Profitabilité · Professionnalisme (seuil 30 %)</p>
                </div>

                <div class="coya-loading" t-if="state.loading">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                </div>

                <t t-if="!state.loading">
                    <!-- Les 3 piliers -->
                    <div class="coya-trinite-piliers">
                        <div class="coya-pilier-card" t-foreach="pilierData" t-as="p" t-key="p.id">
                            <h3 class="coya-pilier-title"><span t-att-class="'coya-pilier-dot coya-' + p.id"/> <t t-esc="p.label"/></h3>
                            <div class="coya-pilier-value" t-esc="Math.round(p.value) + '%'"/>
                            <div class="coya-pilier-bar">
                                <div class="coya-pilier-fill" t-att-style="'width: ' + Math.min(100, Math.max(0, p.value)) + '%;'"/>
                            </div>
                            <p class="coya-pilier-desc" t-esc="p.desc"/>
                        </div>
                    </div>

                    <!-- Alertes ouvertes -->
                    <div class="coya-trinite-alerts" t-if="state.alertes.length > 0">
                        <h3 class="coya-trinite-section-title"><i class="fa fa-exclamation-triangle"/> Alertes Conseil (sous seuil 30 %)</h3>
                        <div class="coya-trinite-alert-list">
                            <t t-foreach="state.alertes" t-as="a" t-key="a.id">
                                <div class="coya-trinite-alert-item" t-on-click="() => this.openAlerte(a)">
                                    <span class="coya-trinite-alert-employee" t-esc="a.employee"/>
                                    <span class="coya-trinite-alert-pilier" t-esc="a.pilier"/>
                                    <span class="coya-trinite-alert-score" t-esc="'Score: ' + Math.round(a.score) + '% (seuil ' + a.seuil + ')'"/>
                                </div>
                            </t>
                        </div>
                    </div>

                    <!-- Liens rapides -->
                    <div class="coya-trinite-actions">
                        <button class="btn btn-primary" t-on-click="() => this.openScores()">
                            <i class="fa fa-line-chart"/> Voir les scores
                        </button>
                        <button class="btn btn-secondary" t-on-click="() => this.openAlertes()">
                            <i class="fa fa-bell"/> Voir les alertes
                        </button>
                        <button class="btn btn-secondary" t-on-click="() => this.openPlans()">
                            <i class="fa fa-file-text-o"/> Plans de paie
                        </button>
                    </div>
                </t>
            </div>
        </div>
    </t>
</templates>
