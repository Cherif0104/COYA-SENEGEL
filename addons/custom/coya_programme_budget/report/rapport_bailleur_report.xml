<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="1">
        <template id="report_rapport_bailleur_document">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="oe_structure"/>
                        <h2>Rapport bailleur — Prévisionnel vs réel</h2>
                        <h3 t-field="o.name"/>
                        <p>
                            <strong>Bailleur :</strong> <t t-field="o.bailleur_id" t-options='{"widget": "contact"}'/>
                            <span t-if="o.date_start or o.date_end">
                                — Période : <t t-field="o.date_start"/> → <t t-field="o.date_end"/>
                            </span>
                            — Devise : <t t-field="o.currency_id.name"/>
                        </p>
                        <table class="table table-sm table-bordered mt-3">
                            <thead>
                                <tr>
                                    <th>Total prévisionnel</th>
                                    <th>Engagé</th>
                                    <th>Payé</th>
                                    <th>Restant</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td t-field="o.montant_total_previsionnel"/>
                                    <td t-field="o.montant_engage"/>
                                    <td t-field="o.montant_paye"/>
                                    <td t-field="o.montant_restant"/>
                                </tr>
                            </tbody>
                        </table>
                        <h4 class="mt-4">Projets</h4>
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Projet</th>
                                    <th>Prévisionnel</th>
                                    <th>Engagé</th>
                                    <th>Payé</th>
                                    <th>Restant</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="o.projet_ids" t-as="projet">
                                    <tr>
                                        <td t-field="projet.name"/>
                                        <td t-field="projet.montant_total_previsionnel"/>
                                        <td t-field="projet.montant_engage"/>
                                        <td t-field="projet.montant_paye"/>
                                        <td t-field="projet.montant_restant"/>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div class="oe_structure"/>
                    </div>
                </t-call>
            </t>
        </template>
        <record id="action_report_rapport_bailleur" model="ir.actions.report">
            <field name="name">Rapport bailleur</field>
            <field name="model">coya.programme</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">coya_programme_budget.report_rapport_bailleur_document</field>
            <field name="print_report_name">(object.name or 'Programme') + ' - Rapport bailleur.pdf'</field>
        </record>
    </data>
</odoo>
