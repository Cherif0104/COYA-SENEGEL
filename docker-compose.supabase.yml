# COYA.PRO – Odoo avec Supabase (projet COYA) comme base PostgreSQL
# Sans service db local. Pour éviter "Network unreachable" (IPv6), utilise le pooler
# SESSION (host aws-0-XX.pooler.supabase.com, port 5432). Voir docs/SUPABASE-IPV4.md
#
# 1. .env : DB_HOST=aws-0-XX.pooler.supabase.com, DB_USER=postgres.ilpmgqguqkueioopqpma, DB_PASSWORD=...
# 2. docker compose -f docker-compose.supabase.yml up -d
# 3. http://localhost:8070

services:
  odoo:
    image: odoo:18
    ports:
      - "8070:8069"
    env_file:
      - .env
    environment:
      HOST: ${DB_HOST}
      USER: ${DB_USER}
      PASSWORD: ${DB_PASSWORD}
      # Pooler Session = port 5432 (IPv4). Ne pas utiliser db.xxx.supabase.co (IPv6 only).
      PORT: ${DB_PORT:-5432}
    command: ["odoo", "-c", "/etc/odoo/odoo-supabase.conf"]
    dns:
      - 8.8.8.8
      - 8.8.4.4
    volumes:
      - odoo-web-data:/var/lib/odoo
      - ./addons/custom:/mnt/extra-addons
      - ./config:/etc/odoo

volumes:
  odoo-web-data:
